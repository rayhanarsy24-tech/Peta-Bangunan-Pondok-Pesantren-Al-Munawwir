<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peta Bangunan Pondok Pesantren Al-Munawwir</title>

  <!-- Mapbox -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css" rel="stylesheet" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
    }

    .navbar {
      background-color: #146655;
      color: #fff;
      padding: 10px 25px;
    }

    #map {
      width: 100%;
      height: 480px;
      border-radius: 10px;
      position: relative;
    }

    #fly {
      background-color: #146655;
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
    }

    footer {
      background-color: #146655;
      color: white;
      text-align: center;
      padding: 15px;
    }

    .popup-content img {
      border-radius: 5px;
      margin-top: 5px;
    }

    /* Tombol Layer */
    .layer-buttons {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .layer-btn {
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      opacity: 0.9;
    }

    .putra-btn { background-color: #e1d59d; color: #333; }
    .putri-btn { background-color: #ffe0a0; color: #333; }
    .umum-btn { background-color: #ffb56e; color: #333; }

    .layer-btn.active {
      box-shadow: 0 0 0 2px #146655;
      opacity: 1;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="container-fluid">
      <span class="navbar-brand text-white fw-bold">Pondok Pesantren Al-Munawwir</span>
    </div>
  </nav>

  <!-- Header -->
  <header class="bg-light py-5 text-center border-bottom mb-4">
    <h2 class="fw-bold" style="color:#146655;">Peta Bangunan Pondok Pesantren Al-Munawwir</h2>
    <button id="fly">Tampilkan Lokasi Pondok</button>
  </header>

  <!-- Map Section -->
  <div class="container my-4">
    <div class="row">
      <div class="col-lg-3">
        <div class="card shadow-sm">
          <div class="card-header bg-success text-white">Petunjuk</div>
          <div class="card-body">
            <ul>
              <li>Arahkan kursor ke area berwarna untuk melihat nama bangunan.</li>
              <li>Gunakan tombol warna di kanan atas untuk menampilkan/menyembunyikan layer.</li>
              <li>Gunakan kontrol navigasi di kiri atas untuk zoom/reset arah.</li>
              <li>Klik tombol di atas untuk menuju lokasi Pondok.</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-9 position-relative">
        <div id="map"></div>

        <!-- Tombol Pembeda -->
        <div class="layer-buttons">
          <button class="layer-btn putra-btn active" data-layer="asrama_putra">Asrama Putra</button>
          <button class="layer-btn putri-btn active" data-layer="asrama_putri">Asrama Putri</button>
          <button class="layer-btn umum-btn active" data-layer="bangunan_umum">Bangunan Umum</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>&copy; 2025 Pondok Pesantren Al-Munawwir</footer>

  <!-- Scripts -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js"></script>

  <script>
    mapboxgl.accessToken = "pk.eyJ1IjoicmFpaGFuYXJzeTIxMiIsImEiOiJjbWdkcnI0eTExbzZiMmxweTZsbTc3bzNwIn0.3VBG0N76EYY7p99jlkcR2w";

    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/streets-v12",
      center: [110.3614, -7.8269],
      zoom: 17
    });

    // Kontrol Navigasi
    map.addControl(new mapboxgl.NavigationControl(), "top-left");

    // Kontrol Directions
    const directions = new MapboxDirections({
      accessToken: mapboxgl.accessToken,
      unit: "metric",
      profile: "mapbox/driving",
      language: "id"
    });
    map.addControl(directions, "top-right");

    // Tombol Fly
    document.getElementById("fly").addEventListener("click", () => {
      map.flyTo({
        center: [110.3614, -7.8269],
        zoom: 17.5,
        bearing: 0,
        pitch: 0,
        duration: 2000
      });
    });

    // Saat map siap
    map.on("load", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          directions.setOrigin([pos.coords.longitude, pos.coords.latitude]);
        });
      }

      // === Load GeoJSON ===
      const sources = [
        { id: "asrama_putra", color: "#e1d59d", data: "assets/geojson/asramaputra.geojson" },
        { id: "asrama_putri", color: "#ffe0a0", data: "assets/geojson/asramaputri.geojson" },
        { id: "bangunan_umum", color: "#ffb56e", data: "assets/geojson/bangunanumum.geojson" }
      ];

      sources.forEach(src => {
        map.addSource(src.id, { type: "geojson", data: src.data });

        map.addLayer({
          id: src.id,
          type: "fill",
          source: src.id,
          paint: {
            "fill-color": src.color,
            "fill-opacity": 0.8
          }
        });

        map.addLayer({
          id: src.id + "_outline",
          type: "line",
          source: src.id,
          paint: {
            "line-color": "black",
            "line-width": 1
          }
        });

        // Popup interaktif
        const popup = new mapboxgl.Popup({ closeButton: false, closeOnClick: true });

        map.on("mouseenter", src.id, e => {
          map.getCanvas().style.cursor = "pointer";
          const feature = e.features[0];
          const nama = feature.properties.Nama || "Bangunan Tanpa Nama";
          const foto = feature.properties.foto && feature.properties.foto.startsWith("<img")
            ? feature.properties.foto.replace("C:\\\\Users\\\\HP\\\\Downloads\\\\Documents\\\\SEMESTER 8 WADOOH\\\\TUGAS AKHIR\\\\Data\\\\HTML\\\\resources\\\\foto\\\\Foto BangunanPsn\\\\", "assets/foto/")
            : "";
          popup.setLngLat(e.lngLat)
               .setHTML(`<div class="popup-content"><strong>${nama}</strong><br>${foto}</div>`)
               .addTo(map);
        });

        map.on("mouseleave", src.id, () => {
          map.getCanvas().style.cursor = "";
          popup.remove();
        });
      });

      // === Tombol Layer (toggle) ===
      document.querySelectorAll(".layer-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const layerId = btn.dataset.layer;
          const visible = map.getLayoutProperty(layerId, "visibility");

          if (visible === "none") {
            map.setLayoutProperty(layerId, "visibility", "visible");
            map.setLayoutProperty(layerId + "_outline", "visibility", "visible");
            btn.classList.add("active");
          } else {
            map.setLayoutProperty(layerId, "visibility", "none");
            map.setLayoutProperty(layerId + "_outline", "visibility", "none");
            btn.classList.remove("active");
          }
        });
      });
    });
  </script>
</body>
</html>
